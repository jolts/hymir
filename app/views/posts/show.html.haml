- title h(@post.title), false

%div#single{:class => @post.published ? nil : 'draft'}
  .content
    .head
      %span.actions
        - if can? :update, @post
          %span.edit= link_to image_tag('page_edit.png'), edit_post_path(@post), :rel => 'tipsy', :title => 'Edit'
        - if can? :destroy, @post
          %span.destroy= link_to image_tag('page_delete.png'), @post, :method => :delete, :confirm => 'Are you sure?', :rel => 'tipsy', :title => 'Destroy'
      %h2.title
        = h @post.title
    .body
      = markdown @post.body
    .foot
      Posted on
      = content_tag :span, @post.created_at.strftime('%B %e %Y at %H:%M'), :title => @post.created_at
      by
      %strong= h @post.creator.username
      - if @post.tags.any?
        and filed under #{tag_paths @post.tags}.
      - else
        and filed without any tags.
      %br/
      Follow any comments to this post through the
      = link_to 'Atom', post_path(@post, :format => :atom), :class => 'feed'
      feed,
      = link_to 'leave a comment', "#{post_path(@post)}#new_comment"
      or
      = link_to 'trackback', post_path(@post, :format => :html)
      from your own site.

#comments
  - if @post.published
    - if @post.comments.any?
      %h2#comments_count= pluralize @post.comments.count, 'Comment'
      %ul#comments_list
        - @post.comments.sort_by {|c| c.created_at}.each do |comment|
          %li{:class => "post_comment#{comment.has_user ? ' has_user' : nil}"}
            .info
              = image_tag comment.gravatar(20), :alt => 'Gravatar', :size => '20x20', :class => 'gravatar'
              %strong.username= link_to_unless comment.url.blank?, h(comment.name), comment.url
              %p.meta= content_tag :span, comment.created_at.strftime('%B %e'), :title => comment.created_at
            .body
              - if can? :destroy, comment
                %span.destroy= link_to image_tag('comment_delete.png'), post_comment_path(@post, comment), :method => :delete, :confirm => 'Are you sure?', :rel => 'tipsy', :title => 'Destroy'
              = markdown comment.body
    - else
      %h2#comments_count No comments yet!
    - if can? :create, Comment
      %h2#new_comment New Comment
      = render 'comments/form'
